<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Last-Words — Admin</title>

<style>
body {
  background:#000;
  color:#f5f5f5;
  font-family: Inter, Arial, sans-serif;
  padding:40px;
}

input {
  padding:10px;
  width:320px;
  background:#111;
  border:1px solid #333;
  color:white;
  border-radius:6px;
}

button {
  padding:8px 14px;
  background:white;
  border:none;
  border-radius:6px;
  cursor:pointer;
  margin-top:10px;
}

.message {
  border-bottom:1px solid #222;
  padding:15px 0;
}

small {
  color:#888;
}
.hidden {
  opacity: 0.4;
}
</style>
</head>

<body>

<h1>Admin — Last Words</h1>

<p>Admin Token</p>
<input id="token" placeholder="Enter admin token">
<br>
<button onclick="loadMessages()">Load messages</button>

<div id="messages"></div>

<script>
async function loadMessages() {
  const token = document.getElementById("token").value;

  const res = await fetch(
    "https://last-words-backend.onrender.com/admin/messages",
    { headers: { "x-admin-token": token } }
  );

  if (!res.ok) return alert("Unauthorized");

  const data = await res.json();
  const container = document.getElementById("messages");
  container.innerHTML = "";

  data.forEach(m => {
    const div = document.createElement("div");
    div.className = "message " + (m.hidden ? "hidden" : "");
    div.innerHTML = `
      <p>${m.message}</p>
      <small>${m.country || ""} · ${m.created_at}</small><br>
      ${m.hidden ? "<small>Hidden</small>" : `<button onclick="hideMessage(${m.id})">Hide</button>`}
    `;
    container.appendChild(div);
  });
}

async function hideMessage(id) {
  const token = document.getElementById("token").value;

  if (!confirm("Hide this message from the public map?")) return;

  const res = await fetch(
    "https://last-words-backend.onrender.com/admin/messages/" + id + "/hide",
    {
      method: "PATCH",
      headers: { "x-admin-token": token }
    }
  );

  if (res.ok) loadMessages();
  else alert("Error hiding message");
}
</script>

</body>
</html>
